@using OneEchan.Server.Models.VideoViewModel

@{
    ViewData["Title"] = "Create new video";
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions {
    private string GetAntiXsrfRequestToken() => Xsrf.GetAndStoreTokens(Context).RequestToken;
}

<div class="row" style="padding: 2em;">
    <h4>Upload Video</h4>
    <br />
    <div id="select-file">
        <input type="file" class="form-control col-md-4" name="file" id="file" />
        <input type="button" class="btn btn-primary col-md-4" name="submit" id="upload-file" value="upload" />
    </div>
    <div id="upload-progress" class="progress col-md-12" style="display:none;">
        <div id="progress-bar"
             class="progress-bar"
             role="progressbar"
             aria-valuenow="0"
             aria-valuemin="0"
             aria-valuemax="100" style="min-width: 2em;">
            0%
        </div>
    </div>
    @Html.Partial("_UploadCallback", new UploadCallbackModel())
</div>

@section Scripts {
    <script src="~/js/aliyun-sdk.min.js"></script>
    <script src="~/js/vod-sdk-upload-1.0.6.min.js"></script>
    @*<script src="https://www.promisejs.org/polyfills/promise-6.1.0.js"></script>
    <script type="text/javascript" src="https://gosspublic.alicdn.com/aliyun-oss-sdk.min.js"></script>*@
    <script>
        function getToken() {
            return '@GetAntiXsrfRequestToken()';
        }
        function getSignatureUrl() {
            return '@Url.Action(nameof(VideoController.GetSignature), nameof(VideoController).Replace("Controller", ""))';
        }
    </script>
    <script src="~/js/video-upload.js"></script>
}