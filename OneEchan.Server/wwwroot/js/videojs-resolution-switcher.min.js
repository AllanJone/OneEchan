/*! videojs-resolution-switcher - 2015-7-26
 * Copyright (c) 2016 Kasper Moskwiak
 * Modified by Pierre Kraft and Derk-Jan Hartman
 * Licensed under the Apache-2.0 license. */
(function(){"use strict";var n=null;n=typeof window.videojs=="undefined"&&typeof require=="function"?require("video.js"):window.videojs,function(n,t){var e,o={ui:!0},u=t.getComponent("MenuItem"),f=t.extend(u,{constructor:function(n,i){i.selectable=!0;u.call(this,n,i);this.src=i.src;n.on("resolutionchange",t.bind(this,this.update))}}),i,r;f.prototype.handleClick=function(n){u.prototype.handleClick.call(this,n);this.player_.currentResolution(this.options_.label)};f.prototype.update=function(){var n=this.player_.currentResolution();this.selected(this.options_.label===n.label)};u.registerComponent("ResolutionMenuItem",f);i=t.getComponent("MenuButton");r=t.extend(i,{constructor:function(n,r){if(this.label=document.createElement("span"),r.label="Quality",i.call(this,n,r),this.el().setAttribute("aria-label","Quality"),this.controlText("Quality"),r.dynamicLabel)t.addClass(this.label,"vjs-resolution-button-label"),this.el().appendChild(this.label);else{var u=document.createElement("span");t.addClass(u,"vjs-menu-icon");this.el().appendChild(u)}n.on("updateSources",t.bind(this,this.update))}});r.prototype.createItems=function(){var i=[],t=this.sources&&this.sources.label||{};for(var n in t)t.hasOwnProperty(n)&&i.push(new f(this.player_,{label:n,src:t[n],selected:n===(this.currentSelection?this.currentSelection.label:!1)}));return i};r.prototype.update=function(){return this.sources=this.player_.getGroupedSrc(),this.currentSelection=this.player_.currentResolution(),this.label.innerHTML=this.currentSelection?this.currentSelection.label:"",i.prototype.update.call(this)};r.prototype.buildCSSClass=function(){return i.prototype.buildCSSClass.call(this)+" vjs-resolution-button"};i.registerComponent("ResolutionMenuButton",r);e=function(n){function h(n,t){return!n.res||!t.res?0:+t.res-+n.res}function s(n){var t={label:{},res:{},type:{}};return n.map(function(n){f(t,"label",n);f(t,"res",n);f(t,"type",n);e(t,"label",n);e(t,"res",n);e(t,"type",n)}),t}function f(n,t,i){n[t][i[t]]==null&&(n[t][i[t]]=[])}function e(n,t,i){n[t][i[t]].push(i)}function c(n,t){var i=u["default"],r="";return i==="high"?(i=t[0].res,r=t[0].label):i!=="low"&&i!=null&&n.res[i]?n.res[i]&&(r=n.res[i][0].label):(i=t[t.length-1].res,r=t[t.length-1].label),{res:i,label:r,sources:n.res[i]}}function l(n){var t={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"auto"}},i=function(t,i){return n.tech_.ytPlayer.setPlaybackQuality(i[0]._yt),n.trigger("updateSources"),n};u.customSourcePicker=i;n.tech_.ytPlayer.setPlaybackQuality("auto");n.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",function(r){for(var u in t)if(u.yt===r.data){n.currentResolution(u.label,i);return}});n.one("play",function(){var f=n.tech_.ytPlayer.getAvailableQualityLevels(),u=[],r;f.map(function(i){u.push({src:n.src().src,type:n.src().type,label:t[i].label,res:t[i].res,_yt:t[i].yt})});n.groupedSrc=s(u);r={label:"auto",res:0,sources:n.groupedSrc.label.auto};this.currentResolutionState={label:r.label,sources:r.sources};n.trigger("updateSources");n.setSourcesSanitized(r.sources,r.label,i)})}var u=t.mergeOptions(o,n),i=this;i.updateSrc=function(n){if(!n)return i.src();n=n.filter(function(n){try{return i.canPlayType(n.type)!==""}catch(t){return!0}});this.currentSources=n.sort(h);this.groupedSrc=s(this.currentSources);var t=c(this.groupedSrc,this.currentSources);return this.currentResolutionState={label:t.label,sources:t.sources},i.trigger("updateSources"),i.setSourcesSanitized(t.sources,t.label),i.trigger("resolutionchange"),i};i.currentResolution=function(n,t){var r;if(n==null)return this.currentResolutionState;if(this.groupedSrc&&this.groupedSrc.label&&this.groupedSrc.label[n]){var e=this.groupedSrc.label[n],o=i.currentTime(),f=i.paused();!f&&this.player_.options_.bigPlayButton&&this.player_.bigPlayButton.hide();r="loadeddata";this.player_.techName_!=="Youtube"&&this.player_.preload()==="none"&&this.player_.techName_!=="Flash"&&(r="timeupdate");i.setSourcesSanitized(e,n,t||u.customSourcePicker).one(r,function(){i.currentTime(o);i.handleTechSeeked_();f||i.play().handleTechSeeked_();i.trigger("resolutionchange")});return i}};i.getGroupedSrc=function(){return this.groupedSrc};i.setSourcesSanitized=function(n,t,r){return(this.currentResolutionState={label:t,sources:n},typeof r=="function")?r(i,n,t):(i.src(n.map(function(n){return{src:n.src,type:n.type,res:n.res}})),i)};i.ready(function(){if(u.ui){var n=new r(i,u);i.controlBar.resolutionSwitcher=i.controlBar.el_.insertBefore(n.el_,i.controlBar.getChild("fullscreenToggle").el_);i.controlBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)}}i.options_.sources.length>1&&i.updateSrc(i.options_.sources);i.techName_==="Youtube"&&l(i)})};t.plugin("videoJsResolutionSwitcher",e)}(window,n)})();